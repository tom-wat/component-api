#!/bin/bash

# ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å®Ÿéš›ã®Worker URLã‚’å–å¾—å¾Œã«å®Ÿè¡Œã—ã¦ãã ã•ã„
# ä½¿ç”¨æ–¹æ³•: ./set-worker-url.sh https://your-actual-worker.workers.dev

if [ -z "$1" ]; then
    echo "âŒ ã‚¨ãƒ©ãƒ¼: Worker URLã‚’æŒ‡å®šã—ã¦ãã ã•ã„"
    echo "ä½¿ç”¨æ–¹æ³•: $0 https://your-worker.workers.dev"
    echo ""
    echo "Worker URLã‚’ç¢ºèªã™ã‚‹ã«ã¯:"
    echo "   npx wrangler list"
    exit 1
fi

WORKER_URL="$1"
FRONTEND_DIR="../component management"
ENV_FILE="$FRONTEND_DIR/.env.local"

echo "ğŸ”§ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç’°å¢ƒå¤‰æ•°ã‚’æ‰‹å‹•è¨­å®šä¸­..."
echo "Worker URL: $WORKER_URL"

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
if [ -f "$ENV_FILE" ]; then
    cp "$ENV_FILE" "$ENV_FILE.backup"
    echo "ğŸ“‹ æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: $ENV_FILE.backup"
fi

# æ–°ã—ã„ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
cat > "$ENV_FILE" << EOF
# API Base URL - Cloudflare Workers
VITE_API_URL=$WORKER_URL

# é–‹ç™ºç’°å¢ƒã§ãƒªãƒ¢ãƒ¼ãƒˆAPIã‚’ä½¿ç”¨ã™ã‚‹
VITE_DEV_USE_REMOTE=true

# Environment
VITE_ENVIRONMENT=production
NODE_ENV=development
EOF

echo "âœ… ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸ: $ENV_FILE"
echo ""
echo "ğŸ“ è¨­å®šå†…å®¹:"
cat "$ENV_FILE"
echo ""
echo "ğŸ§ª APIæ¥ç¶šãƒ†ã‚¹ãƒˆ:"
curl -s "$WORKER_URL/api/health" | jq '.' 2>/dev/null || curl -s "$WORKER_URL/api/health"
echo ""
echo "ğŸš€ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„:"
echo "   cd '$FRONTEND_DIR'"
echo "   npm run dev"
